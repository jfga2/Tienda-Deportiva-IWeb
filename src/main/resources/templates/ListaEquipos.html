<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments::head (titulo='Listado de Equipos')"></head>
<body>
<div th:replace="fragments::menu"></div>

<div class="container mt-5">
    <h1 class="mb-4 text-center">Listado de Equipos</h1>

    <!-- Formulario para crear equipo -->
    <form action="#" method="post" th:action="@{/equipos/crear}">
        <div class="input-group mb-3">
            <input type="text" name="nombre" class="form-control" placeholder="Nombre del equipo" required>
            <input type="text" name="descripcion" class="form-control" placeholder="Descripci贸n del equipo">
            <button class="btn btn-primary" type="submit">Crear equipo</button>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle text-center shadow-sm">
            <thead class="table-primary">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Nombre</th>
                <th scope="col">Descripcion</th>
                <th scope="col">Unirse/Salirse del grupo</th>
                <!-- Solo mostramos esta columna si el usuario es administrador -->
                <th scope="col" th:if="${esAdministrador}">Eliminar/Cambiar nombre Grupo</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="equipo : ${equipos}">
                <td th:text="${equipo.id}"></td>
                <td>
                    <a class="btn btn-primary" th:href="@{/equipos/{id}(id=${equipo.id})}" th:text="${equipo.nombre}"></a>
                </td>
                <td th:text="${equipo.descripcion}"></td>
                <td>
                    <!-- Botones para unirse/salir del equipo -->
                    <div class="d-flex justify-content-around">
                        <!-- Mostrar bot贸n "Unirse" si el usuario no pertenece al equipo -->
                        <form th:if="${perteneceAlEquipo[equipo.id] == false}"
                              th:action="@{/equipos/{id}/unirse(id=${equipo.id})}" method="post" class="d-inline">
                            <button class="btn btn-success" type="submit">Unirse</button>
                        </form>
                        <!-- Mostrar bot贸n "Salir" si el usuario pertenece al equipo -->
                        <form th:if="${perteneceAlEquipo[equipo.id] == true}"
                              th:action="@{/equipos/{id}/salir(id=${equipo.id})}" method="post" class="d-inline">
                            <button class="btn btn-warning" type="submit">Salir</button>
                        </form>
                    </div>
                </td>
                <!-- Acciones solo para administradores -->
                <td th:if="${esAdministrador}">
                    <div class="d-flex justify-content-around">
                        <!-- Formulario para actualizar el nombre del equipo -->
                        <form th:action="@{/equipos/{id}/actualizarNombre(id=${equipo.id})}" method="post" class="d-inline">
                            <input type="text" name="nuevoNombre" placeholder="Nuevo nombre" class="form-control mb-2" required />
                            <button class="btn btn-info" type="submit">Actualizar</button>
                        </form>
                        <!-- Bot贸n para eliminar equipo -->
                        <form th:action="@{/equipos/{id}/eliminar(id=${equipo.id})}" method="post" class="d-inline">
                            <button class="btn btn-danger" type="submit">Eliminar</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div th:replace="fragments::javascript"></div>
</body>
</html>
